<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scripts - Projet PPE</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            background-color: #fcfcfc;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .hero-small {
            background: var(--primary-gradient);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }

        pre {
            border-radius: 8px;
            padding: 0;
            background-color: #0d1117;
        }

        code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
        }

        .main-title {
            color: #4a4a4a !important;
            border-bottom: 2px solid #764ba2;
            display: inline-block;
            padding-bottom: 5px;
            margin-bottom: 20px;
        }

        .notification {
            code {
                color: black;
            }
        }
    </style>
</head>

<body>

    <nav class="navbar has-shadow" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="../index.html">
                <span class="icon has-text-primary"><i class="fa-solid fa-globe"></i></span>
                <span class="ml-2 has-text-weight-bold">PPE Projet</span>
            </a>
            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasic">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div id="navbarBasic" class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item" href="../index.html">Accueil</a>

                <div class="navbar-item has-dropdown is-hoverable">
                    <a class="navbar-item" href="../index.html#Presentation">Le projet</a>
                    <div class="navbar-dropdown">
                        <a class="navbar-item" href="../index.html#Presentation">Présentation</a>
                        <a class="navbar-item" href="../index.html#Methodologie">Méthodologie</a>
                    </div>
                </div>

                <a class="navbar-item is-active" href="script.html">
                    Scripts
                </a>

                <div class="navbar-item has-dropdown is-hoverable">
                    <a class="navbar-item" href="tableaux.html">Tableaux</a>
                    <div class="navbar-dropdown">
                        <a class="navbar-item" href="../tableaux/tab_fr.html">Français</a>
                        <a class="navbar-item" href="../tableaux/tab_it.html">Italien</a>
                        <a class="navbar-item" href="../tableaux/tab_ru.html">Russe</a>
                    </div>
                </div>

                <a class="navbar-item" href="analyse.html">Analyses</a>
                <a class="navbar-item" href="nous.html">L'équipe</a>
            </div>
        </div>
    </nav>

    <div class="hero-small has-text-centered">
        <h1 class="title is-2 has-text-white">Scripts</h1>
        <p class="subtitle is-5 has-text-white-ter">Le moteur de notre projet</p>
    </div>

    <section class="section">
        <div class="container">
            <div class="content">
                <h1 class="main-title">Script de traitement global (Bash)</h2>
                    <p>
                        Nous avons conçu un script unique capable de traiter les trois langues (Français, Italien,
                        Russe).
                        Il prend en argument le fichier d'URL, le dossier de sortie, le nom du fichier résultat, le
                        mot-clé
                        (regex) et le code langue.
                    </p>
            </div>

            <div class="box">
                <pre><code class="language-bash">#!/bin/bash
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8

if [ $# -ne 5 ]
then
    echo "ATTENTION! ce script va supprimer le contenu du dossier aspirations"
    echo "Le script attend strictement cinq arguments: le chemin vers le fichier d'URL et le chemin vers le dossier de sortie"
    echo "et le nom du fichier de résultat, le mot clé et la langue"
    echo "pour la langue écrire 'it|fr|ru'"
    exit
fi

FICHIER_URL=$1 # fichier contenant les URLs à traiter
DOSSIER_TABLEAUX=$2 # dossier de sortie pour les fichiers générés
FICHIER_RESULTAT=$3 # nom de fichier résultat
MOT_CLE=$4 # regex
LANGUE=$5 # la langue, pour pouvoir nommer les fichiers

# Créer les dossiers s'ils n'existent pas
mkdir -p "$DOSSIER_TABLEAUX/../aspirations"
mkdir -p "$DOSSIER_TABLEAUX/../dumps-text"
mkdir -p "$DOSSIER_TABLEAUX/../contextes"
mkdir -p "$DOSSIER_TABLEAUX/../concordances"
mkdir -p "$DOSSIER_TABLEAUX/../bigrams"

echo "Nettoyage des anciens fichiers pour la langue: $LANGUE ..."
rm -f "$DOSSIER_TABLEAUX/../aspirations/${LANGUE}-"*
rm -f "$DOSSIER_TABLEAUX/../dumps-text/${LANGUE}-"*
rm -f "$DOSSIER_TABLEAUX/../contextes/${LANGUE}-"*
rm -f "$DOSSIER_TABLEAUX/../concordances/${LANGUE}-"*
rm -f "$DOSSIER_TABLEAUX/../bigrams/${LANGUE}-"*

echo "&lt;!DOCTYPE html&gt;
&lt;html lang=\"fr\"&gt;
&lt;head&gt;
    &lt;meta charset=\"UTF-8\"&gt;
    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;
    &lt;title&gt;Tableau des résultats : $MOT_CLE&lt;/title&gt;
    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css\"&gt;
    &lt;style&gt;
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        body {
            background-color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .hero {
            background: var(--primary-gradient);
            color: white;
        }
        .section {
            flex: 1;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;section class=\"hero is-small\"&gt;
        &lt;div class=\"hero-body\"&gt;
            &lt;div class=\"container\"&gt;
                &lt;div class=\"columns is-vcentered\"&gt;
                    &lt;div class=\"column\"&gt;
                        &lt;h1 class=\"title has-text-white\"&gt;Résultats pour : '$MOT_CLE'&lt;/h1&gt;
                    &lt;/div&gt;
                    &lt;div class=\"column is-narrow\"&gt;
                        &lt;a href=\"../index.html\" class=\"button is-light is-outlined\"&gt;
                            Retour à l'accueil
                        &lt;/a&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/section&gt;

    &lt;section class=\"section\"&gt;
        &lt;div class=\"container\"&gt;
            &lt;div class=\"box\"&gt;
                &lt;div class=\"table-container\"&gt;
                    &lt;table class=\"table is-bordered is-striped is-hoverable is-fullwidth\"&gt;
                        &lt;thead&gt;
                            &lt;tr&gt;
                                &lt;th&gt;N°&lt;/th&gt;
                                &lt;th&gt;URL&lt;/th&gt;
                                &lt;th&gt;Code HTTP&lt;/th&gt;
                                &lt;th&gt;Encodage&lt;/th&gt;
                                &lt;th&gt;Occurrences&lt;/th&gt;
                                &lt;th&gt;Concordancier&lt;/th&gt;
                                &lt;th&gt;Bigrammes&lt;/th&gt;
                                &lt;th&gt;HTML&lt;/th&gt;
                                &lt;th&gt;TXT&lt;/th&gt;
                                &lt;th&gt;Contexte&lt;/th&gt;
                            &lt;/tr&gt;
                        &lt;/thead&gt;
                        &lt;tbody&gt;" &gt; "$FICHIER_RESULTAT"

lineno=1
while read -r URL; do
    URL=$(echo "$URL" | tr -d '\r')

    if [ -n "$URL" ]; then
        echo "Traitement de la ligne $lineno: $URL"

        f_aspirations="$DOSSIER_TABLEAUX/../aspirations/${LANGUE}-${lineno}.html"
        f_dump="$DOSSIER_TABLEAUX/../dumps-text/${LANGUE}-${lineno}.txt"
        f_contexte="$DOSSIER_TABLEAUX/../contextes/${LANGUE}-${lineno}.txt"
        f_concordance="$DOSSIER_TABLEAUX/../concordances/${LANGUE}-${lineno}.html"
        f_2gram="$DOSSIER_TABLEAUX/../bigrams/${LANGUE}-${lineno}.html"

        # Récupérer la page
        code=$(curl -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36" -L -s -o "$f_aspirations" -w "%{http_code}" "$URL")
        encoding="N/A"
        nb_contexte=0

        # Si pas d'erreur lors de la récupération
        if [ "$code" == "200" ]; then
            encoding=$(file -b --mime-encoding "$f_aspirations")
            
            if [ "$encoding" == "utf-8" ]; then
                lynx -stdin -dump -nolist -display_charset=UTF-8 &lt; "$f_aspirations" &gt; "$f_dump"
                grep -E -i -C 2 "$MOT_CLE" "$f_dump" &gt; "$f_contexte"
            else
                if [ -n "$encoding" ] && [ "$encoding" != "binary" ]; then
                    iconv -f "$encoding" -t "UTF-8//IGNORE" -c "$f_aspirations" | lynx -stdin -dump -nolist -display_charset=UTF-8 &gt; "$f_dump"
                    grep -E -i -C 2 "$MOT_CLE" "$f_dump" &gt; "$f_contexte"
                else
                    echo "" &gt; "$f_dump"
                    echo "" &gt; "$f_contexte"
                fi
            fi

            if [ -s "$f_contexte" ]; then
                nb_contexte=$(grep -c . "$f_contexte")
            else
                nb_contexte=0
            fi

            compte=$(grep -o -i "$MOT_CLE" "$f_dump" | wc -l)

            # Construction du concordancier
            echo "&lt;!DOCTYPE html&gt;
&lt;html lang=\"fr\"&gt;
&lt;head&gt;
    &lt;meta charset=\"UTF-8\"&gt;
    &lt;title&gt;Concordancier : $MOT_CLE&lt;/title&gt;
    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css\"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;section class=\"section\"&gt;
        &lt;div class=\"container\"&gt;
            &lt;h1 class=\"title\"&gt;Concordancier pour le mot : $MOT_CLE&lt;/h1&gt;
            &lt;a href=\"../$FICHIER_RESULTAT\" class=\"button is-small is-link is-outlined mb-4\"&gt;Retour au tableau&lt;/a&gt;
            &lt;table class=\"table is-striped is-hoverable is-fullwidth\"&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th class=\"has-text-right\" style=\"width:45%\"&gt;Contexte gauche&lt;/th&gt;
                        &lt;th class=\"has-text-centered\"&gt;Mot&lt;/th&gt;
                        &lt;th class=\"has-text-left\" style=\"width:45%\"&gt;Contexte droit&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;" &gt; "$f_concordance"

            grep -E -o -i ".{0,50}$MOT_CLE.{0,50}" "$f_dump" | sed -E "s/($MOT_CLE)/&lt;\/td&gt;&lt;td class=\"has-text-centered\"&gt;&lt;strong&gt;\1&lt;\/strong&gt;&lt;\/td&gt;&lt;td class=\"has-text-left\"&gt;/I" | sed -E "s/^/&lt;tr&gt;&lt;td class=\"has-text-right\"&gt;/" | sed -E "s/$/&lt;\/td&gt;&lt;\/tr&gt;/" &gt;&gt; "$f_concordance"

            echo "&lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
    &lt;/section&gt;
&lt;/body&gt;
&lt;/html&gt;" &gt;&gt; "$f_concordance"


            # Construction des 2-grammes
            echo "&lt;!DOCTYPE html&gt;
&lt;html lang=\"fr\"&gt;
&lt;head&gt;
    &lt;meta charset=\"UTF-8\"&gt;
    &lt;title&gt;Bigrammes : $MOT_CLE&lt;/title&gt;
    &lt;link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css\"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;section class=\"section\"&gt;
        &lt;div class=\"container\"&gt;
            &lt;h1 class=\"title\"&gt;Bigrammes pour le mot : $MOT_CLE&lt;/h1&gt;
            &lt;a href=\"../$FICHIER_RESULTAT\" class=\"button is-small is-link is-outlined mb-4\"&gt;Retour au tableau&lt;/a&gt;
            &lt;table class=\"table is-striped is-hoverable is-fullwidth\"&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th class=\"has-text-right\" style=\"width:45%\"&gt;Contexte gauche&lt;/th&gt;
                        &lt;th class=\"has-text-centered\"&gt;Mot&lt;/th&gt;
                        &lt;th class=\"has-text-left\" style=\"width:45%\"&gt;Contexte droit&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;" &gt; "$f_2gram"

            grep -P -o -i "\w+\W+\w*$MOT_CLE\w*\W+\w+" "$f_dump" | sed -E "s/(\w*$MOT_CLE\w*)/&lt;\/td&gt;&lt;td class=\"has-text-centered\"&gt;&lt;strong&gt;\1&lt;\/strong&gt;&lt;\/td&gt;&lt;td class=\"has-text-left\"&gt;/I" | sed -E "s/^/&lt;tr&gt;&lt;td class=\"has-text-right\"&gt;/" | sed -E "s/$/&lt;\/td&gt;&lt;\/tr&gt;/" &gt;&gt; "$f_2gram"

            echo "&lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
    &lt;/section&gt;
&lt;/body&gt;
&lt;/html&gt;" &gt;&gt; "$f_2gram"

        else
            echo "" &gt; "$f_dump"
            echo "Erreur HTTP $code" &gt; "$f_contexte"
            echo "" &gt; "$f_concordance"
            compte=0
        fi

        echo "    &lt;tr&gt;
        &lt;td&gt;$lineno&lt;/td&gt;
        &lt;td&gt;&lt;a href=\"$URL\" target=\"_blank\"&gt;lien&lt;/a&gt;&lt;/td&gt;
        &lt;td&gt;$code&lt;/td&gt;
        &lt;td&gt;$encoding&lt;/td&gt;
        &lt;td&gt;$compte&lt;/td&gt;
        &lt;td&gt;&lt;a href=\"../concordances/${LANGUE}-${lineno}.html\"&gt;concordance&lt;/a&gt;&lt;/td&gt;
        &lt;td&gt;&lt;a href=\"../bigrams/${LANGUE}-${lineno}.html\"&gt;bigrammes&lt;/a&gt;&lt;/td&gt;
        &lt;td&gt;&lt;a href=\"../aspirations/${LANGUE}-${lineno}.html\"&gt;html&lt;/a&gt;&lt;/td&gt;
        &lt;td&gt;&lt;a href=\"../dumps-text/${LANGUE}-${lineno}.txt\"&gt;txt&lt;/a&gt;&lt;/td&gt;
        &lt;td&gt;&lt;a href=\"../contextes/${LANGUE}-${lineno}.txt\"&gt;contexte ($nb_contexte lignes)&lt;/a&gt;&lt;/td&gt;
        &lt;/tr&gt;" &gt;&gt; "$FICHIER_RESULTAT"

        ((lineno++))

    fi
done &lt; "$FICHIER_URL"

echo "&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/section&gt;" &gt;&gt; "$FICHIER_RESULTAT"
echo "fichier texte généré: $FICHIER_RESULTAT"</code></pre>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="notification is-light">
                <h3 class="subtitle">Commandes utilisées pour lancer le script :</h3>
                <pre><code>./programmes/script_URLs_treatement.sh URLs/it.txt tableaux/ tableaux/tab_it.html "spirito" it
./programmes/script_URLs_treatement.sh URLs/fr.txt tableaux/ tableaux/tab_fr.html "esprit" fr
./programmes/script_URLs_treatement.sh URLs/ru.txt tableaux/ tableaux/tab_ru.html "дух[а-я]*" ru</code></pre>
            </div>
        </div>
    </section>


    <footer class="footer">
        <div class="content has-text-centered">
            <p><strong>Projet PPE</strong>. Université Sorbonne Nouvelle.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
            if ($navbarBurgers.length > 0) {
                $navbarBurgers.forEach(el => {
                    el.addEventListener('click', () => {
                        const target = el.dataset.target;
                        const $target = document.getElementById(target);
                        el.classList.toggle('is-active');
                        $target.classList.toggle('is-active');
                    });
                });
            }
        });
    </script>
</body>

</html>